<?xml version="1.0" encoding="utf-8"?>
<Window
    x:Class="Panomi.UI.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:Panomi.UI"
    Title="">

    <Grid Background="#000000" XYFocusKeyboardNavigation="Enabled">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="14"/>
        </Grid.ColumnDefinitions>
        
        <!-- Main Content -->
        <ScrollViewer x:Name="MainScrollViewer" Grid.Column="0" 
                      VerticalScrollBarVisibility="Hidden"
                      HorizontalScrollBarVisibility="Disabled"
                      HorizontalContentAlignment="Stretch"
                      ViewChanged="MainScrollViewer_ViewChanged">
            <Grid Margin="24,24,24,24" HorizontalAlignment="Stretch" XYFocusKeyboardNavigation="Enabled">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Header Section -->
                <Grid Grid.Row="0" Margin="0,16,0,24">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <!-- Logo and Buttons -->
                    <StackPanel Grid.Column="0" VerticalAlignment="Top">
                        <Image Source="Assets/logo_png.png" Width="120" Height="120" HorizontalAlignment="Left" Margin="-4,0,0,16"/>
                        
                        <StackPanel Orientation="Horizontal" Spacing="12">
                            <Button x:Name="ScanButton" Click="ScanButton_Click" 
                                    Style="{StaticResource DarkRectButtonStyle}">
                                <TextBlock x:Name="ScanButtonText" FontSize="14"/>
                            </Button>
                            <Button x:Name="SpotifyButton" Click="SpotifyButton_Click"
                                    Style="{StaticResource DarkRectButtonStyle}">
                                <TextBlock Text="Spotify" FontSize="14"/>
                            </Button>
                            <Button x:Name="DiscordButton" Click="DiscordButton_Click"
                                    Height="44" Padding="10,0" CornerRadius="10"
                                    Style="{StaticResource DarkRectButtonStyle}">
                                <Grid>
                                    <Image x:Name="DiscordIcon" Width="24" Height="24"/>
                                    <TextBlock x:Name="DiscordFallbackText" Text="Discord" FontSize="14" 
                                               Foreground="White" VerticalAlignment="Center"
                                               Visibility="Collapsed"/>
                                </Grid>
                            </Button>
                            <Button x:Name="AILinksButton"
                                    Width="44" Height="44" Padding="0" CornerRadius="10"
                                    Style="{StaticResource DarkRectButtonStyle}"
                                    ToolTipService.ToolTip="AI Tools">
                                <TextBlock Text="AI" FontSize="16" FontWeight="Bold" Foreground="White"/>
                                <Button.Flyout>
                                    <MenuFlyout Placement="BottomEdgeAlignedLeft">
                                        <MenuFlyout.MenuFlyoutPresenterStyle>
                                            <Style TargetType="MenuFlyoutPresenter">
                                                <Setter Property="Background" Value="#0f1114"/>
                                                <Setter Property="BorderBrush" Value="#2a2a2f"/>
                                                <Setter Property="BorderThickness" Value="1"/>
                                                <Setter Property="Padding" Value="4"/>
                                                <Setter Property="CornerRadius" Value="8"/>
                                            </Style>
                                        </MenuFlyout.MenuFlyoutPresenterStyle>
                                        <MenuFlyoutItem x:Name="AIChatGPT" Text="ChatGPT" Click="WebLink_Click" Tag="https://chat.openai.com" Foreground="White"/>
                                        <MenuFlyoutItem x:Name="AIClaude" Text="Claude" Click="WebLink_Click" Tag="https://claude.ai" Foreground="White"/>
                                        <MenuFlyoutItem x:Name="AIDeepSeek" Text="DeepSeek" Click="WebLink_Click" Tag="https://chat.deepseek.com" Foreground="White"/>
                                        <MenuFlyoutItem x:Name="AIGemini" Text="Gemini" Click="WebLink_Click" Tag="https://gemini.google.com" Foreground="White"/>
                                        <MenuFlyoutItem x:Name="AIGrok" Text="Grok" Click="WebLink_Click" Tag="https://grok.x.ai" Foreground="White"/>
                                        <MenuFlyoutItem x:Name="AIMetaAI" Text="Meta AI" Click="WebLink_Click" Tag="https://meta.ai" Foreground="White"/>
                                    </MenuFlyout>
                                </Button.Flyout>
                            </Button>
                            <Button x:Name="WebLinksButton"
                                    Width="44" Height="44" Padding="0" CornerRadius="10"
                                    Style="{StaticResource DarkRectButtonStyle}"
                                    ToolTipService.ToolTip="Web Links">
                                <FontIcon Glyph="&#xE774;" FontSize="20" Foreground="White"/>
                                <Button.Flyout>
                                    <MenuFlyout Placement="BottomEdgeAlignedLeft">
                                        <MenuFlyout.MenuFlyoutPresenterStyle>
                                            <Style TargetType="MenuFlyoutPresenter">
                                                <Setter Property="Background" Value="#0f1114"/>
                                                <Setter Property="BorderBrush" Value="#2a2a2f"/>
                                                <Setter Property="BorderThickness" Value="1"/>
                                                <Setter Property="Padding" Value="4"/>
                                                <Setter Property="CornerRadius" Value="8"/>
                                            </Style>
                                        </MenuFlyout.MenuFlyoutPresenterStyle>
                                        
                                        <!-- Console (alphabetical) -->
                                        <MenuFlyoutSubItem x:Name="WebConsoleMenu" Text="Console" Foreground="White">
                                            <MenuFlyoutItem x:Name="WebNintendo" Text="Nintendo" Click="WebLink_Click" Tag="https://www.nintendo.com" Foreground="White"/>
                                            <MenuFlyoutItem x:Name="WebPlayStation" Text="PlayStation" Click="WebLink_Click" Tag="https://www.playstation.com" Foreground="White"/>
                                            <MenuFlyoutItem x:Name="WebXbox" Text="Xbox" Click="WebLink_Click" Tag="https://www.xbox.com" Foreground="White"/>
                                        </MenuFlyoutSubItem>
                                        
                                        <!-- Live Streaming (alphabetical) -->
                                        <MenuFlyoutSubItem x:Name="WebLiveStreamingMenu" Text="Live Streaming" Foreground="White">
                                            <MenuFlyoutItem x:Name="WebKick" Text="Kick" Click="WebLink_Click" Tag="https://www.kick.com" Foreground="White"/>
                                            <MenuFlyoutItem x:Name="WebRumble" Text="Rumble" Click="WebLink_Click" Tag="https://www.rumble.com" Foreground="White"/>
                                            <MenuFlyoutItem x:Name="WebTwitch" Text="Twitch" Click="WebLink_Click" Tag="https://www.twitch.tv" Foreground="White"/>
                                        </MenuFlyoutSubItem>
                                        
                                        <!-- Misc (alphabetical) -->
                                        <MenuFlyoutSubItem x:Name="WebMiscMenu" Text="Misc" Foreground="White">
                                            <MenuFlyoutItem x:Name="WebAmazonStore" Text="Amazon" Click="WebLink_Click" Tag="https://www.amazon.com" Foreground="White"/>
                                            <MenuFlyoutItem x:Name="WebGitHub" Text="GitHub" Click="WebLink_Click" Tag="https://www.github.com" Foreground="White"/>
                                            <MenuFlyoutItem x:Name="WebGoogle" Text="Google" Click="WebLink_Click" Tag="https://www.google.com" Foreground="White"/>
                                            <MenuFlyoutItem x:Name="WebWikipedia" Text="Wikipedia" Click="WebLink_Click" Tag="https://www.wikipedia.org" Foreground="White"/>
                                        </MenuFlyoutSubItem>
                                        
                                        <!-- PC (alphabetical) -->
                                        <MenuFlyoutSubItem x:Name="WebPCMenu" Text="PC" Foreground="White">
                                            <MenuFlyoutItem x:Name="WebPCPartPicker" Text="PCPartPicker" Click="WebLink_Click" Tag="https://pcpartpicker.com" Foreground="White"/>
                                        </MenuFlyoutSubItem>
                                        
                                        <!-- Social Media (alphabetical) -->
                                        <MenuFlyoutSubItem x:Name="WebSocialMediaMenu" Text="Social Media" Foreground="White">
                                            <MenuFlyoutItem x:Name="WebFacebook" Text="Facebook" Click="WebLink_Click" Tag="https://www.facebook.com" Foreground="White"/>
                                            <MenuFlyoutItem x:Name="WebInstagram" Text="Instagram" Click="WebLink_Click" Tag="https://www.instagram.com" Foreground="White"/>
                                            <MenuFlyoutItem x:Name="WebReddit" Text="Reddit" Click="WebLink_Click" Tag="https://www.reddit.com" Foreground="White"/>
                                            <MenuFlyoutItem x:Name="WebTikTok" Text="TikTok" Click="WebLink_Click" Tag="https://www.tiktok.com" Foreground="White"/>
                                            <MenuFlyoutItem x:Name="WebWhatsApp" Text="WhatsApp" Click="WebLink_Click" Tag="https://web.whatsapp.com" Foreground="White"/>
                                            <MenuFlyoutItem x:Name="WebX" Text="X" Click="WebLink_Click" Tag="https://www.x.com" Foreground="White"/>
                                            <MenuFlyoutItem x:Name="WebYouTube" Text="YouTube" Click="WebLink_Click" Tag="https://www.youtube.com" Foreground="White"/>
                                        </MenuFlyoutSubItem>
                                        
                                        <!-- TV Streaming (alphabetical) -->
                                        <MenuFlyoutSubItem x:Name="WebTVStreamingMenu" Text="TV Streaming" Foreground="White">
                                            <MenuFlyoutItem x:Name="WebAmazonPrime" Text="Amazon Prime" Click="WebLink_Click" Tag="https://www.primevideo.com" Foreground="White"/>
                                            <MenuFlyoutItem x:Name="WebAppleTV" Text="Apple TV+" Click="WebLink_Click" Tag="https://tv.apple.com" Foreground="White"/>
                                            <MenuFlyoutItem x:Name="WebDisneyPlus" Text="Disney+" Click="WebLink_Click" Tag="https://www.disneyplus.com" Foreground="White"/>
                                            <MenuFlyoutItem x:Name="WebNetflix" Text="Netflix" Click="WebLink_Click" Tag="https://www.netflix.com" Foreground="White"/>
                                        </MenuFlyoutSubItem>
                                        
                                        <!-- Support -->
                                        <MenuFlyoutSubItem x:Name="WebSupportMenu" Text="Support" Foreground="White">
                                            <MenuFlyoutItem x:Name="WebLinktree" Text="Linktree" Click="WebLink_Click" Tag="https://linktr.ee/panomiltd" Foreground="White"/>
                                        </MenuFlyoutSubItem>
                                        
                                    </MenuFlyout>
                                </Button.Flyout>
                            </Button>
                            <Button x:Name="UpdateButton" Click="UpdateButton_Click"
                                    Visibility="Collapsed"
                                    Style="{StaticResource DarkRectButtonStyle}">
                                <TextBlock x:Name="UpdateButtonText" Text="Update Available" FontSize="14" Foreground="#4ade80"/>
                            </Button>
                        </StackPanel>
                    </StackPanel>

                    <!-- Stats -->
                    <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="16" VerticalAlignment="Top" Margin="0,16,0,0">
                        <Border Background="#0f1114" CornerRadius="12" Padding="24,16" MinWidth="110">
                            <StackPanel>
                                <TextBlock x:Name="StatTotalLabel" Foreground="#888" FontSize="13"/>
                                <TextBlock x:Name="TotalCount" Text="0" Foreground="White" FontSize="32" FontWeight="Bold"/>
                            </StackPanel>
                        </Border>
                        <Border Background="#0f1114" CornerRadius="12" Padding="24,16" MinWidth="110">
                            <StackPanel>
                                <TextBlock x:Name="StatLaunchersLabel" Foreground="#888" FontSize="13"/>
                                <TextBlock x:Name="LauncherCount" Text="0" Foreground="White" FontSize="32" FontWeight="Bold"/>
                            </StackPanel>
                        </Border>
                        <Border Background="#0f1114" CornerRadius="12" Padding="24,16" MinWidth="110">
                            <StackPanel>
                                <TextBlock x:Name="StatGamesLabel" Foreground="#888" FontSize="13"/>
                                <TextBlock x:Name="GameCount" Text="0" Foreground="White" FontSize="32" FontWeight="Bold"/>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </Grid>

                <!-- Search and Filter -->
                <Grid Grid.Row="1" Margin="0,0,0,24">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <TextBox x:Name="SearchBox" 
                             PlaceholderText="" 
                             Background="#0f1114" 
                             Foreground="White"
                             BorderBrush="#1a1a1f"
                             Padding="16,12"
                             TextChanged="SearchBox_TextChanged"
                             HorizontalAlignment="Stretch"/>

                    <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8" Margin="16,0,0,0">
                        <Button x:Name="FilterAll" Click="FilterAll_Click"
                                Style="{StaticResource CyanPillButtonStyle}"/>
                        <Button x:Name="FilterLaunchers" Click="FilterLaunchers_Click"
                                Style="{StaticResource DarkPillButtonStyle}"/>
                        <Button x:Name="FilterGames" Click="FilterGames_Click"
                                Style="{StaticResource DarkPillButtonStyle}"/>
                        <Button x:Name="SourceFilterButton"
                                Style="{StaticResource DarkPillButtonStyle}">
                            <Button.Flyout>
                                <Flyout x:Name="SourceFilterFlyout" Placement="BottomEdgeAlignedRight">
                                    <Flyout.FlyoutPresenterStyle>
                                        <Style TargetType="FlyoutPresenter">
                                            <Setter Property="Background" Value="#0f1114"/>
                                            <Setter Property="BorderBrush" Value="#2a2a2f"/>
                                            <Setter Property="BorderThickness" Value="1"/>
                                            <Setter Property="Padding" Value="8"/>
                                            <Setter Property="CornerRadius" Value="8"/>
                                        </Style>
                                    </Flyout.FlyoutPresenterStyle>
                                    <StackPanel x:Name="SourceFilterPanel" MinWidth="180" Spacing="4" XYFocusKeyboardNavigation="Enabled"/>
                                </Flyout>
                            </Button.Flyout>
                        </Button>
                        <Button x:Name="FilterFavorites" Click="FilterFavorites_Click"
                                Width="40" Height="40" Padding="0" CornerRadius="20"
                                Style="{StaticResource DarkPillButtonStyle}">
                            <FontIcon x:Name="FavoritesIcon" Glyph="&#xE734;" FontSize="16" Foreground="White"/>
                        </Button>
                        <Button x:Name="SettingsButton"
                                Width="40" Height="40" Padding="0" CornerRadius="20"
                                Style="{StaticResource DarkPillButtonStyle}">
                            <Button.Flyout>
                                <Flyout x:Name="SettingsFlyout" Placement="BottomEdgeAlignedRight">
                                    <Flyout.FlyoutPresenterStyle>
                                        <Style TargetType="FlyoutPresenter">
                                            <Setter Property="Background" Value="#0f1114"/>
                                            <Setter Property="BorderBrush" Value="#2a2a2f"/>
                                            <Setter Property="BorderThickness" Value="1"/>
                                            <Setter Property="Padding" Value="8"/>
                                            <Setter Property="CornerRadius" Value="8"/>
                                        </Style>
                                    </Flyout.FlyoutPresenterStyle>
                                    <StackPanel MinWidth="180" Spacing="4" XYFocusKeyboardNavigation="Enabled">
                                        <Grid x:Name="FullscreenRow" Padding="4,6,4,6" 
                                              Background="Transparent" PointerPressed="FullscreenRow_PointerPressed">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBlock x:Name="FullscreenText" Foreground="White" VerticalAlignment="Center"/>
                                            <CheckBox x:Name="FullscreenToggle" Grid.Column="1" 
                                                      Checked="FullscreenToggle_Changed" Unchecked="FullscreenToggle_Changed"
                                                      KeyDown="SettingsCheckbox_KeyDown"
                                                      MinWidth="0" Padding="0"/>
                                        </Grid>
                                        
                                        <Grid x:Name="StartupRow" Padding="4,6,4,6" 
                                              Background="Transparent" PointerPressed="StartupRow_PointerPressed">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBlock x:Name="StartupText" Foreground="White" VerticalAlignment="Center"/>
                                            <CheckBox x:Name="StartupToggle" Grid.Column="1" 
                                                      Checked="StartupToggle_Changed" Unchecked="StartupToggle_Changed"
                                                      KeyDown="SettingsCheckbox_KeyDown"
                                                      MinWidth="0" Padding="0"/>
                                        </Grid>
                                        
                                        <Grid x:Name="MinimizeToTrayRow" Padding="4,6,4,6" 
                                              Background="Transparent" PointerPressed="MinimizeToTrayRow_PointerPressed"
                                              ToolTipService.Placement="Left">
                                            <ToolTipService.ToolTip>
                                                <ToolTip x:Name="QuickLaunchTooltip" Background="#0f1114" BorderBrush="#2a2a2f" BorderThickness="1" CornerRadius="8" Padding="12,8">
                                                    <TextBlock x:Name="QuickLaunchInfoText" Foreground="White" FontSize="12" MaxWidth="250" TextWrapping="Wrap"/>
                                                </ToolTip>
                                            </ToolTipService.ToolTip>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBlock x:Name="MinimizeToTrayText" Foreground="White" VerticalAlignment="Center"/>
                                            <CheckBox x:Name="MinimizeToTrayToggle" Grid.Column="1" 
                                                      Checked="MinimizeToTrayToggle_Changed" Unchecked="MinimizeToTrayToggle_Changed"
                                                      KeyDown="SettingsCheckbox_KeyDown"
                                                      GotFocus="QuickLaunchToggle_GotFocus" LostFocus="QuickLaunchToggle_LostFocus"
                                                      MinWidth="0" Padding="0"/>
                                        </Grid>
                                        
                                        <!-- Language Selector -->
                                        <Button x:Name="LanguageButton" 
                                                HorizontalAlignment="Stretch" 
                                                HorizontalContentAlignment="Left"
                                                Background="Transparent" 
                                                Foreground="White" 
                                                Padding="4,6,4,6"
                                                BorderThickness="0">
                                            <Button.Content>
                                                <TextBlock x:Name="LanguageText" Text="Language" Foreground="White" VerticalAlignment="Center"/>
                                            </Button.Content>
                                            <Button.Flyout>
                                                <Flyout x:Name="LanguageFlyout" Placement="LeftEdgeAlignedTop" Closed="LanguageFlyout_Closed">
                                                    <Flyout.FlyoutPresenterStyle>
                                                        <Style TargetType="FlyoutPresenter">
                                                            <Setter Property="Background" Value="#0f1114"/>
                                                            <Setter Property="BorderBrush" Value="#2a2a2f"/>
                                                            <Setter Property="BorderThickness" Value="1"/>
                                                            <Setter Property="Padding" Value="8"/>
                                                            <Setter Property="CornerRadius" Value="8"/>
                                                        </Style>
                                                    </Flyout.FlyoutPresenterStyle>
                                                    <StackPanel x:Name="LanguagePanel" MinWidth="120" Spacing="2" XYFocusKeyboardNavigation="Enabled"/>
                                                </Flyout>
                                            </Button.Flyout>
                                        </Button>
                                    </StackPanel>
                                </Flyout>
                            </Button.Flyout>
                            <FontIcon x:Name="SettingsIcon" Glyph="&#xE713;" FontSize="16" Foreground="White"/>
                        </Button>
                    </StackPanel>
                </Grid>

                <!-- Library Header -->
                <Grid Grid.Row="2" Margin="0,0,0,16">
                    <TextBlock x:Name="LibraryHeader" FontSize="24" FontWeight="Bold" Foreground="White"/>
                </Grid>

                <!-- Cards Grid - responsive layout -->
                <ItemsRepeater x:Name="CardsGrid" Grid.Row="3" HorizontalAlignment="Stretch">
                    <ItemsRepeater.Layout>
                        <UniformGridLayout Orientation="Horizontal" 
                                           MinItemWidth="300"
                                           MinItemHeight="145"
                                           MinRowSpacing="16"
                                           MinColumnSpacing="16"
                                           ItemsStretch="Fill"
                                           ItemsJustification="Start"/>
                    </ItemsRepeater.Layout>
                    <ItemsRepeater.ItemTemplate>
                        <DataTemplate>
                            <Border CornerRadius="16" Background="#0f1114" Height="145">
                                <Grid>
                                    <!-- Name with optional icon -->
                                    <StackPanel Orientation="Horizontal" VerticalAlignment="Top" Margin="16,20,48,0">
                                        <!-- Launcher icon (native, no border) for launchers with icons -->
                                        <Image Source="{Binding LauncherIcon}" Width="28" Height="28"
                                               Margin="0,0,10,0"
                                               Visibility="{Binding HasLauncherIcon, Converter={StaticResource BoolToVisibilityConverter}}"/>
                                        <!-- Rounded square icon for games -->
                                        <Border Width="28" Height="28" CornerRadius="6" 
                                                Margin="0,0,10,0"
                                                Visibility="{Binding GameIcon, Converter={StaticResource NullToCollapsedConverter}}">
                                            <Border.Background>
                                                <ImageBrush ImageSource="{Binding GameIcon}" Stretch="UniformToFill"/>
                                            </Border.Background>
                                        </Border>
                                        <!-- Panomi logo fallback for games without icons -->
                                        <Grid Width="28" Height="28" Margin="0,0,10,0" CornerRadius="6"
                                              Visibility="{Binding ShowFallbackIcon, Converter={StaticResource BoolToVisibilityConverter}}">
                                            <Image Source="ms-appx:///Assets/logo_png.png" Stretch="UniformToFill"/>
                                        </Grid>
                                        <FontIcon Glyph="{Binding TitleGlyph}" FontSize="18" Foreground="White" 
                                                  Margin="0,0,6,0" VerticalAlignment="Center"
                                                  Visibility="{Binding HasTitleGlyph, Converter={StaticResource BoolToVisibilityConverter}}"/>
                                        <StackPanel VerticalAlignment="Center">
                                            <TextBlock Text="{Binding Name}" Foreground="White" 
                                                       FontSize="16" FontWeight="SemiBold"
                                                       TextWrapping="Wrap" MaxLines="2"/>
                                            <TextBlock Text="{Binding LauncherName}" Foreground="#888" 
                                                       FontSize="12"
                                                       Visibility="{Binding HasMultipleLaunchers, Converter={StaticResource BoolToVisibilityConverter}}"/>
                                        </StackPanel>
                                    </StackPanel>
                                    
                                    <Grid VerticalAlignment="Bottom" Margin="12,0,12,12">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        
                                        <Button Content="{Binding LaunchText}" 
                                                Click="LaunchItem_Click"
                                                Tag="{Binding}"
                                                Grid.Column="0"
                                                HorizontalAlignment="Stretch" 
                                                Padding="0,12"
                                                Style="{StaticResource CyanLaunchButtonStyle}"
                                                Margin="0,0,8,0"/>
                                        
                                        <Button Click="FavoriteItem_Click"
                                                Tag="{Binding}"
                                                Grid.Column="1"
                                                Width="44" Height="44"
                                                Padding="0"
                                                CornerRadius="10"
                                                Background="#1a1a1f">
                                            <FontIcon Glyph="{Binding FavoriteIcon}" 
                                                      FontSize="18"
                                                      Foreground="{Binding IsFavorite, Converter={StaticResource BoolToFavoriteColorConverter}}"/>
                                        </Button>
                                    </Grid>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ItemsRepeater.ItemTemplate>
                </ItemsRepeater>

                <!-- Empty State -->
                <StackPanel x:Name="EmptyState" Grid.Row="3" 
                            HorizontalAlignment="Center" VerticalAlignment="Center"
                            Visibility="Collapsed" Margin="0,60,0,0">
                    <FontIcon Glyph="&#xE7FC;" FontSize="64" Foreground="#444"/>
                    <TextBlock Text="No items found" FontSize="20" Foreground="#666" 
                               HorizontalAlignment="Center" Margin="0,16,0,0"/>
                </StackPanel>
            </Grid>
        </ScrollViewer>

        <!-- Loading Overlay -->
        <!-- Custom Scrollbar Track and Thumb -->
        <Grid x:Name="ScrollTrack" Grid.Column="1" Background="#1a1a1f" Margin="2,8,2,8"
              PointerPressed="ScrollTrack_PointerPressed">
            <Border x:Name="ScrollThumb" 
                    Background="#666666" 
                    CornerRadius="4"
                    VerticalAlignment="Top"
                    Height="100"
                    Margin="1"
                    PointerPressed="ScrollThumb_PointerPressed"
                    PointerMoved="ScrollThumb_PointerMoved"
                    PointerReleased="ScrollThumb_PointerReleased"
                    PointerCaptureLost="ScrollThumb_PointerReleased"/>
        </Grid>
        
        <Grid x:Name="LoadingOverlay" Grid.ColumnSpan="2" Background="#DD000000" Visibility="Collapsed">
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                <ProgressRing IsActive="True" Width="48" Height="48" Foreground="#00D4AA"/>
                <TextBlock x:Name="LoadingText" Text="Scanning..." Foreground="White" 
                           Margin="0,16,0,0" FontSize="16"/>
            </StackPanel>
        </Grid>
    </Grid>
</Window>
